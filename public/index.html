<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azure Blob Folder Search</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
    h1 { text-align: center; color: #333; }
    input { padding: 10px; width: 300px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    #loading { text-align: center; margin: 20px; font-size: 18px; color: #666; display: none; }
    #loading::after { content: ''; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-left: 10px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: none; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #f2f2f2; color: #333; }
    details { cursor: pointer; }
    ul { list-style-type: none; padding: 0; }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Search Azure Blobs Folders</h1>
  <input type="text" id="searchInput" placeholder="Enter folder name (exact match)">
  <button onclick="searchFiles()">Search</button>
  <div id="loading">Searching...</div>
  <table id="resultsTable">
    <thead>
      <tr>
        <th>Folder Name</th>
        <th>Full Path</th>
        <th>Last Modified</th>
        <th>Languages</th>
        <th>Download</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function searchFiles() {
      const query = document.getElementById('searchInput').value;
      const loading = document.getElementById('loading');
      const table = document.getElementById('resultsTable');
      loading.style.display = 'block';
      table.style.display = 'none';
      try {
        const response = await fetch(`/search?query=${encodeURIComponent(query)}`);
        const data = await response.json();
        const tbody = document.querySelector('#resultsTable tbody');
        tbody.innerHTML = '';
        data.forEach(folder => {
          const row = tbody.insertRow();
          row.insertCell().textContent = folder.name;
          row.insertCell().textContent = folder.fullPath;
          row.insertCell().textContent = folder.lastModified;

          const langCell = row.insertCell();
          const details = document.createElement('details');
          const summary = document.createElement('summary');
          const langKeys = Object.keys(folder.languages).sort();
          summary.textContent = langKeys.join(', ') || 'N/A';
          details.appendChild(summary);

          const ul = document.createElement('ul');
          langKeys.forEach(lang => {
            const li = document.createElement('li');
            li.textContent = `${lang}: ${folder.languages[lang]}`;
            ul.appendChild(li);
          });
          details.appendChild(ul);
          langCell.appendChild(details);

          const downloadCell = row.insertCell();
          const link = document.createElement('a');
          link.href = folder.downloadUrl;
          link.textContent = 'Download Folder';
          link.target = '_blank';
          downloadCell.appendChild(link);
        });
        table.style.display = 'table';
      } catch (error) {
        console.error('Search error:', error);
      } finally {
        loading.style.display = 'none';
      }
    }
  </script>
</body>
</html>